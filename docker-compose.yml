services:
  # Generic service - entrypoint can be overridden dynamically
  ai-cli:
    build:
      context: .
      dockerfile: Docker/Dockerfile.ai-cli
      args:
        - ARG_UV_VERSION=${UV_VERSION}
        - ARG_PYTHON_VERSION=${PYTHON_VERSION}
        - ARG_PLAYWRIGHT_CLI_VERSION=${PLAYWRIGHT_CLI_VERSION}
    working_dir: /workspace
    environment:
      - DISPLAY=host.docker.internal:0.0
      - PLAYWRIGHT_MCP_CONFIG=/home/aiuser/playwright-cli.json
      - PLAYWRIGHT_MCP_BROWSER=chromium
      - PLAYWRIGHT_MCP_HEADLESS=false
      - PLAYWRIGHT_CLI_VERSION=${PLAYWRIGHT_CLI_VERSION}
    volumes:
      # Mount the *caller's* CWD (set by wrapper) into /workspace
      - type: bind
        source: ${HOST_PWD}
        target: /workspace
      # Persist full home (auth + settings)
      - ai-cli_home:/home/aiuser
      - playwright_cache:/home/aiuser/.cache/ms-playwright   # <-- persist browsers
    stdin_open: true
    tty: true

volumes:
  ai-cli_home: {}
  playwright_cache: {}
